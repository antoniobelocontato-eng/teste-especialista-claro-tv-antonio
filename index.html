<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Vendas - Streaming Brasil</title>
    <style>
        :root { --claro-red: #ee1d23; --dark-bg: #141414; --card-bg: #1f1f1f; }
        body { background: var(--dark-bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        
        /* NavegaÃ§Ã£o */
        .header-nav { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 30px; align-items: center; }
        .dropdown { position: relative; display: inline-block; }
        .dropbtn { background: #333; color: white; padding: 12px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .dropdown-content { display: none; position: absolute; background: #333; min-width: 160px; z-index: 10; border-radius: 5px; }
        .dropdown-content a { color: white; padding: 12px; text-decoration: none; display: block; }
        .dropdown-content a:hover { background: var(--claro-red); }
        .dropdown:hover .dropdown-content { display: block; }

        .streaming-filters button { background: #222; color: white; border: 1px solid #444; padding: 10px 15px; cursor: pointer; border-radius: 5px; }
        .streaming-filters button:hover { background: var(--claro-red); border-color: var(--claro-red); }

        /* Grid e Cards */
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .card { background: var(--card-bg); border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid #333; }
        .card-streamings { background: #000; color: #ffd700; padding: 10px; text-align: center; font-size: 0.75rem; font-weight: bold; }
        .card-title { padding: 10px; font-size: 1.1rem; text-align: center; margin: 0; min-height: 50px; }
        .card-poster { width: 100%; height: 380px; object-fit: cover; }
        .card-content { padding: 15px; flex-grow: 1; }
        .card-synopsis { font-size: 0.85rem; color: #bbb; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .card-footer { padding: 15px; background: #111; display: flex; flex-direction: column; gap: 8px; }
        
        .btn-yt { background: #ff0000; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-temp { background: #007bff; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .pop-note { font-size: 0.9rem; color: #4caf50; font-weight: bold; text-align: right; }

        /* Modal Temporadas */
        #modal-temporadas { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); overflow-y: auto; }
        .modal-content { background: #222; margin: 5% auto; padding: 25px; width: 90%; max-width: 800px; border-radius: 10px; }
        .temp-item { margin-bottom: 10px; border: 1px solid #444; }
        .temp-header { width: 100%; background: #333; color: white; padding: 15px; text-align: left; border: none; cursor: pointer; font-size: 1rem; }
        .ep-list { padding: 15px; background: #1a1a1a; display: none; }
        .ep-item { margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .ep-item h4 { color: #ffd700; margin: 0 0 5px 0; }
        .ep-item p { font-size: 0.85rem; color: #ccc; margin: 0; }
        .close-modal { float: right; font-size: 2rem; cursor: pointer; }
    </style>
</head>
<body>

    <nav class="header-nav">
        <div class="dropdown">
            <button class="dropbtn">ðŸ“… HistÃ³rico</button>
            <div class="dropdown-content">
                <a href="#" onclick="buscarComFiltro('2025-01-01')">2025 atÃ© hoje</a>
                <a href="#" onclick="buscarComFiltro('2024-01-01')">2024 atÃ© hoje</a>
                <a href="#" onclick="buscarComFiltro('')">Todo o HistÃ³rico</a>
            </div>
        </div>
        <div class="streaming-filters">
            <button onclick="filtrarStreaming(8)">Netflix</button>
            <button onclick="filtrarStreaming(337)">Disney+</button>
            <button onclick="filtrarStreaming(384)">HBO Max</button>
            <button onclick="filtrarStreaming(119)">Prime Video</button>
            <button onclick="filtrarStreaming(350)">Apple TV+</button>
            <button onclick="filtrarStreaming(307)">Globoplay</button>
        </div>
    </nav>

    <h2 id="view-title">ðŸ”¥ Populares no Brasil</h2>
    <div id="grid-filmes" class="grid-layout"></div>
    <br><hr><br>
    <h2>ðŸ“º SÃ©ries Populares</h2>
    <div id="grid-series" class="grid-layout"></div>

    <div id="modal-temporadas">
        <div class="modal-content">
            <span class="close-modal" onclick="fecharModal()">&times;</span>
            <div id="lista-detalhada"></div>
        </div>
    </div>

    <script>
        const API_KEY = "a3e15f985435c14269f8f3e9bfacb207";
        const BASE_URL = "https://api.themoviedb.org/3";

        async function init() {
            await carregarDados('movie', 'grid-filmes');
            await carregarDados('tv', 'grid-series');
        }

        async function carregarDados(tipo, containerId, extraParams = '') {
            const url = `${BASE_URL}/discover/${tipo}?api_key=${API_KEY}&language=pt-BR&sort_by=popularity.desc&watch_region=BR&page=1${extraParams}`;
            const res = await fetch(url);
            const data = await res.json();
            renderCards(data.results.slice(0, 5), containerId, tipo);
        }

        async function renderCards(lista, containerId, tipo) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";
            for (const item of lista) {
                const providers = await getProviders(tipo, item.id);
                const trailer = await getTrailer(tipo, item.id);
                
                container.innerHTML += `
                    <div class="card">
                        <div class="card-streamings">${providers}</div>
                        <h3 class="card-title">${item.title || item.name}</h3>
                        <img src="https://image.tmdb.org/t/p/w500${item.poster_path}" class="card-poster">
                        <div class="card-content">
                            <p class="card-synopsis">${item.overview || "Sem sinopse."}</p>
                        </div>
                        <div class="card-footer">
                            <div class="pop-note">Nota: ${item.vote_average.toFixed(1)}</div>
                            <button class="btn-yt" onclick="window.open('${trailer}')">Trailer YouTube</button>
                            ${tipo === 'tv' ? `<button class="btn-temp" onclick="abrirTemporadas(${item.id})">Temporadas</button>` : ''}
                        </div>
                    </div>
                `;
            }
        }

        async function getProviders(tipo, id) {
            const res = await fetch(`${BASE_URL}/${tipo}/${id}/watch/providers?api_key=${API_KEY}`);
            const data = await res.json();
            const br = data.results?.BR?.flatrate || [];
            const nomes = br.map(p => p.provider_name).slice(0, 3);
            return nomes.length > 0 ? nomes.join(" | ") : "Consultar Disponibilidade";
        }

        async function getTrailer(tipo, id) {
            const res = await fetch(`${BASE_URL}/${tipo}/${id}/videos?api_key=${API_KEY}&language=pt-BR`);
            const data = await res.json();
            const trail = data.results.find(v => v.type === "Trailer") || data.results[0];
            return trail ? `https://www.youtube.com/watch?v=${trail.key}` : "#";
        }

        // --- SISTEMA DE TEMPORADAS E EPISÃ“DIOS ---
        async function abrirTemporadas(id) {
            const res = await fetch(`${BASE_URL}/tv/${id}?api_key=${API_KEY}&language=pt-BR`);
            const serie = await res.json();
            let html = `<h2>${serie.name}</h2>`;
            
            for (const t of serie.seasons) {
                if (t.season_number === 0) continue;
                html += `
                    <div class="temp-item">
                        <button class="temp-header" onclick="toggleEp(${id}, ${t.season_number})">
                            ${t.name} (${t.episode_count} Eps)
                        </button>
                        <div id="eps-cont-${t.season_number}" class="ep-list"></div>
                    </div>
                `;
            }
            document.getElementById('lista-detalhada').innerHTML = html;
            document.getElementById('modal-temporadas').style.display = "block";
        }

        async function toggleEp(id, num) {
            const cont = document.getElementById(`eps-cont-${num}`);
            if (cont.style.display === "block") { cont.style.display = "none"; return; }
            
            const res = await fetch(`${BASE_URL}/tv/${id}/season/${num}?api_key=${API_KEY}&language=pt-BR`);
            const data = await res.json();
            cont.innerHTML = data.episodes.map(e => `
                <div class="ep-item">
                    <h4>Ep ${e.episode_number}: ${e.name}</h4>
                    <p>${e.overview || "Sem descriÃ§Ã£o."}</p>
                </div>
            `).join('');
            cont.style.display = "block";
        }

        function buscarComFiltro(data) {
            const f = data ? `&primary_release_date.gte=${data}&first_air_date.gte=${data}` : '';
            carregarDados('movie', 'grid-filmes', f);
            carregarDados('tv', 'grid-series', f);
        }

        function filtrarStreaming(pid) {
            const f = `&with_watch_providers=${pid}&watch_region=BR`;
            carregarDados('movie', 'grid-filmes', f);
            carregarDados('tv', 'grid-series', f);
        }

        function fecharModal() { document.getElementById('modal-temporadas').style.display = "none"; }
        
        init();
    </script>
</body>
</html>
