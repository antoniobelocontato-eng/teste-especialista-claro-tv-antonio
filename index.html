<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineClaro - Portal de Conte√∫do</title>
    <style>
        :root { 
            --claro-red: #ee1d23; 
            --deep-black: #0a0a0a;
            --surface-color: #1a1a1a;
            --accent-gold: #ffd700;
            --text-main: #ffffff;
            --text-dim: #b3b3b3;
        }

        /* Est√©tica de Cinema */
        body { 
            background-color: var(--deep-black);
            background-image: radial-gradient(circle at top, #3a0000 0%, #0a0a0a 100%);
            background-attachment: fixed;
            color: var(--text-main); 
            font-family: 'Inter', 'Segoe UI', sans-serif; 
            margin: 0; 
            padding: 20px; 
        }

        h2 { 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            border-left: 5px solid var(--claro-red); 
            padding-left: 15px;
            margin: 40px 0 20px;
            font-size: 1.5rem;
        }

        /* Navega√ß√£o Estilizada */
        .header-nav { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 40px; justify-content: center; align-items: center; }
        
        .dropbtn { 
            background: rgba(255, 255, 255, 0.05); 
            color: white; 
            padding: 15px 25px; 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 50px; 
            cursor: pointer; 
            font-weight: bold; 
            backdrop-filter: blur(10px);
            transition: 0.3s;
        }
        .dropbtn:hover { border-color: var(--claro-red); background: var(--claro-red); }

        .streaming-filters { display: flex; gap: 12px; }
        .btn-filter-logo { 
            background: rgba(255, 255, 255, 0.08); 
            border: 2px solid transparent; 
            border-radius: 15px; 
            padding: 8px; 
            cursor: pointer; 
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 55px; height: 55px;
        }
        .btn-filter-logo img { width: 100%; height: 100%; border-radius: 10px; object-fit: cover; }
        .btn-filter-logo:hover { transform: scale(1.2); border-color: var(--claro-red); box-shadow: 0 0 20px rgba(238, 29, 35, 0.4); }

        /* Grid e Cards de Luxo */
        .grid-layout { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; }
        
        .card { 
            background: var(--surface-color); 
            border-radius: 20px; 
            overflow: hidden; 
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: 0.4s;
            position: relative;
        }
        .card:hover { transform: translateY(-10px); border-color: var(--claro-red); box-shadow: 0 15px 35px rgba(0,0,0,0.8); }

        .card-streamings { 
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            padding: 15px; display: flex; justify-content: flex-start; gap: 8px; position: absolute; top: 0; width: 100%; z-index: 2;
        }
        .stream-logo-small { width: 32px; height: 32px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.2); }

        .card-poster { width: 100%; height: 420px; object-fit: cover; transition: 0.5s; }
        .card:hover .card-poster { transform: scale(1.05); }

        .card-content { padding: 20px; background: linear-gradient(0deg, var(--surface-color) 70%, transparent 100%); margin-top: -60px; position: relative; z-index: 1; }
        
        .card-title { font-size: 1.2rem; margin: 0 0 10px 0; color: white; height: 50px; display: flex; align-items: center; }
        .card-synopsis { font-size: 0.85rem; color: var(--text-dim); line-height: 1.5; height: 60px; overflow: hidden; margin-bottom: 15px; }

        .card-footer { padding: 0 20px 20px; display: flex; flex-direction: column; gap: 10px; }
        
        .btn-yt { background: var(--claro-red); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .btn-temp { background: transparent; color: white; border: 1px solid var(--text-dim); padding: 10px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .btn-temp:hover { border-color: white; background: rgba(255,255,255,0.1); }

        /* Modal Premium */
        #modal-temporadas { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(8px); }
        .modal-content { background: #111; margin: 2% auto; padding: 30px; width: 85%; max-width: 900px; border-radius: 25px; border: 1px solid var(--claro-red); max-height: 90vh; overflow-y: auto; }
        
        /* Scrollbar Personalizada */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--deep-black); }
        ::-webkit-scrollbar-thumb { background: var(--claro-red); border-radius: 10px; }
    </style>
</head>
<body>

    <nav class="header-nav">
        <div class="dropdown">
            <button class="dropbtn">‚åõ EXPLORAR TEMPO</button>
            <div class="dropdown-content" style="display:none; position: absolute; background: #222; min-width: 180px; border-radius: 10px; margin-top: 5px;">
                <a href="#" onclick="buscarComFiltro('2025-01-01')" style="color: white; padding: 12px; text-decoration: none; display: block;">2025 - Futuro</a>
                <a href="#" onclick="buscarComFiltro('2024-01-01')" style="color: white; padding: 12px; text-decoration: none; display: block;">2024 - Recentes</a>
                <a href="#" onclick="buscarComFiltro('')" style="color: white; padding: 12px; text-decoration: none; display: block;">Cl√°ssicos e Todos</a>
            </div>
        </div>

        <div class="streaming-filters">
            <button class="btn-filter-logo" onclick="filtrarStreaming(8)" title="Netflix"><img src="https://image.tmdb.org/t/p/original/wwemzKWzjKYJFfCeiB57q3r4Bcm.png"></button>
            <button class="btn-filter-logo" onclick="filtrarStreaming(337)" title="Disney+"><img src="https://image.tmdb.org/t/p/original/78S08rmPB9Pb9STpS5fRA9L6tbr.png"></button>
            <button class="btn-filter-logo" onclick="filtrarStreaming(384)" title="HBO Max"><img src="https://image.tmdb.org/t/p/original/aSj9vP8AnY9Y7V070p880p9v99R.png"></button>
            <button class="btn-filter-logo" onclick="filtrarStreaming(119)" title="Prime Video"><img src="https://image.tmdb.org/t/p/original/dQeYvS7y7Xv9vxV9G67pk69t9cn.png"></button>
            <button class="btn-filter-logo" onclick="filtrarStreaming(350)" title="Apple TV+"><img src="https://image.tmdb.org/t/p/original/68vAnU6AIpX99BsV9whuR9exbiW.png"></button>
            <button class="btn-filter-logo" onclick="filtrarStreaming(307)" title="Globoplay"><img src="https://image.tmdb.org/t/p/original/8vS3X67pX90Y1XjXv9whuR9exbiW.png"></button>
        </div>
    </nav>

    <main>
        <section>
            <h2>üé¨ Cinema em Casa (Filmes)</h2>
            <div id="grid-filmes" class="grid-layout"></div>
        </section>

        <section>
            <h2>üçø Maratonar (S√©ries)</h2>
            <div id="grid-series" class="grid-layout"></div>
        </section>
    </main>

    <div id="modal-temporadas">
        <div class="modal-content">
            <span style="float:right; cursor:pointer; font-size:2rem; color:var(--claro-red)" onclick="fecharModal()">&times;</span>
            <div id="lista-detalhada"></div>
        </div>
    </div>

    <script>
        const API_KEY = "a3e15f985435c14269f8f3e9bfacb207";
        const BASE_URL = "https://api.themoviedb.org/3";

        // Dropdown Logic Fix
        document.querySelector('.dropbtn').addEventListener('click', function() {
            const content = document.querySelector('.dropdown-content');
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        });

        async function init() {
            // Garante que mostre apenas o que est√° em streaming flatrate no BR
            const config = "&with_watch_monetization_types=flatrate&watch_region=BR";
            await carregarDados('movie', 'grid-filmes', config);
            await carregarDados('tv', 'grid-series', config);
        }

        async function carregarDados(tipo, containerId, extra = '') {
            const url = `${BASE_URL}/discover/${tipo}?api_key=${API_KEY}&language=pt-BR&sort_by=popularity.desc&watch_region=BR&page=1${extra}`;
            const res = await fetch(url);
            const data = await res.json();
            renderCards(data.results.slice(0, 5), containerId, tipo);
        }

        async function renderCards(lista, containerId, tipo) {
            const container = document.getElementById(containerId);
            container.innerHTML = "";
            for (const item of lista) {
                const providers = await getProviders(tipo, item.id);
                const trailer = await getTrailer(tipo, item.id);
                
                container.innerHTML += `
                    <div class="card">
                        <div class="card-streamings">${providers}</div>
                        <img src="https://image.tmdb.org/t/p/w500${item.poster_path}" class="card-poster">
                        <div class="card-content">
                            <h3 class="card-title">${item.title || item.name}</h3>
                            <p class="card-synopsis">${item.overview || "Sinopse protegida ou n√£o dispon√≠vel no momento."}</p>
                        </div>
                        <div class="card-footer">
                            <button class="btn-yt" onclick="window.open('${trailer}')">Ver Trailer</button>
                            ${tipo === 'tv' ? `<button class="btn-temp" onclick="abrirTemporadas(${item.id})">Explorar Temporadas</button>` : ''}
                        </div>
                    </div>`;
            }
        }

        async function getProviders(tipo, id) {
            const res = await fetch(`${BASE_URL}/${tipo}/${id}/watch/providers?api_key=${API_KEY}`);
            const data = await res.json();
            const br = data.results?.BR?.flatrate || [];
            
            // Se n√£o houver flatrate, busca rent/buy como plano B
            const backup = data.results?.BR?.rent || [];
            const final = br.length > 0 ? br : backup;

            return final.slice(0, 3).map(p => `
                <img src="https://image.tmdb.org/t/p/w500${p.logo_path}" class="stream-logo-small" title="${p.provider_name}">
            `).join('');
        }

        async function getTrailer(tipo, id) {
            const res = await fetch(`${BASE_URL}/${tipo}/${id}/videos?api_key=${API_KEY}&language=pt-BR`);
            const data = await res.json();
            const t = data.results.find(v => v.type === "Trailer") || data.results[0];
            return t ? `https://www.youtube.com/watch?v=${t.key}` : "https://youtube.com";
        }

        async function abrirTemporadas(id) {
            const res = await fetch(`${BASE_URL}/tv/${id}?api_key=${API_KEY}&language=pt-BR`);
            const s = await res.json();
            let h = `<h2 style="border:none; padding:0; color:var(--claro-red)">${s.name}</h2>`;
            s.seasons.forEach(t => {
                if(t.season_number > 0) {
                    h += `<div style="margin-top:10px">
                            <button class="btn-temp" style="width:100%; text-align:left" onclick="toggleEp(${id},${t.season_number})">‚ñº ${t.name}</button>
                            <div id="eps-${t.season_number}" style="display:none; padding:15px; background:#111; border-radius:0 0 10px 10px"></div>
                          </div>`;
                }
            });
            document.getElementById('lista-detalhada').innerHTML = h;
            document.getElementById('modal-temporadas').style.display = "block";
        }

        async function toggleEp(id, n) {
            const c = document.getElementById(`eps-${n}`);
            if(c.style.display === "block") { c.style.display = "none"; return; }
            const res = await fetch(`${BASE_URL}/tv/${id}/season/${n}?api_key=${API_KEY}&language=pt-BR`);
            const d = await res.json();
            c.innerHTML = d.episodes.map(e => `<div style="margin-bottom:15px; border-bottom:1px solid #222; padding-bottom:10px">
                <strong style="color:var(--accent-gold)">${e.episode_number}. ${e.name}</strong>
                <p style="font-size:0.8rem; color:#aaa; margin:5px 0">${e.overview || "Sinopse em breve."}</p>
            </div>`).join('');
            c.style.display = "block";
        }

        function buscarComFiltro(d) {
            const f = d ? `&primary_release_date.gte=${d}&first_air_date.gte=${d}&with_watch_monetization_types=flatrate` : '&with_watch_monetization_types=flatrate';
            carregarDados('movie', 'grid-filmes', f); 
            carregarDados('tv', 'grid-series', f);
            document.querySelector('.dropdown-content').style.display = 'none';
        }

        function filtrarStreaming(p) {
            const f = `&with_watch_providers=${p}&watch_region=BR&with_watch_monetization_types=flatrate`;
            carregarDados('movie', 'grid-filmes', f); 
            carregarDados('tv', 'grid-series', f);
        }

        function fecharModal() { document.getElementById('modal-temporadas').style.display = "none"; }
        
        init();
    </script>
</body>
</html>
